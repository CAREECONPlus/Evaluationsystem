<!DOCTYPE html>
<!-- å»ºè¨­æ¥­è©•ä¾¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - Firebase Hostingé…ä¿¡ -->
<!-- Live URL: https://hyouka-db.web.app -->
<!-- Version: 2025-01-11-v2 - CORS Fix & Cache Busting -->
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å»ºè¨­æ¥­å‘ã‘è©•ä¾¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ä½œæ¥­å“¡ã®è©•ä¾¡ã‚’åŠ¹ç‡çš„ã«ç®¡ç†">
    <meta name="keywords" content="å»ºè¨­æ¥­,è©•ä¾¡ç®¡ç†,äººäº‹è©•ä¾¡,ä½œæ¥­å“¡ç®¡ç†">
    <meta name="author" content="Construction Evaluation System">
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://www.gstatic.com https://fonts.googleapis.com https://careeconplus.github.io *.gstatic.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com https://careeconplus.github.io; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; connect-src 'self' https://*.googleapis.com https://*.firebaseapp.com https://*.cloudfunctions.net https://careeconplus.github.io">
    
    <!-- OGPè¨­å®š -->
    <meta property="og:title" content="å»ºè¨­æ¥­è©•ä¾¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ">
    <meta property="og:description" content="ä½œæ¥­å“¡ã®è©•ä¾¡ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚·ã‚¹ãƒ†ãƒ ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hyouka-db.firebaseapp.com">
    
    <!-- PWAè¨­å®šï¼ˆä¿®æ­£ç‰ˆï¼‰ -->
    <meta name="theme-color" content="#007bff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="è©•ä¾¡ç®¡ç†">
    <link rel="manifest" href="./manifest.json">
    
    <!-- Firebase Configuration Meta Tags -->
    <!-- CORS Fix: Using both firebaseapp.com and web.app domains -->
    <meta name="firebase-api-key" content="AIzaSyAK3wAWIZCultkSQfyse8L8Z-JNMEVK5Wk">
    <meta name="firebase-auth-domain" content="hyouka-db.firebaseapp.com">
    <meta name="firebase-project-id" content="hyouka-db">
    <meta name="firebase-storage-bucket" content="hyouka-db.appspot.com">
    <meta name="firebase-messaging-sender-id" content="861016804589">
    <meta name="firebase-app-id" content="1:861016804589:web:d911d516d6c79aa73690e4">
    <!-- Alternative auth domain for web.app -->
    <meta name="firebase-alt-auth-domain" content="hyouka-db.web.app">
    
    <title data-i18n="app.system_name">å»ºè¨­æ¥­è©•ä¾¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    
    <!-- å¤–éƒ¨CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ CSS -->
    <link href="./styles.css" rel="stylesheet">
    <!-- Phase 8: Enhanced Responsive CSS -->
    <link href="./styles/responsive.css" rel="stylesheet">
    
    <!-- Faviconï¼ˆãƒ‡ãƒ¼ã‚¿URIã§å¯¾å¿œï¼‰ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23007bff'/><text y='50' x='50' text-anchor='middle' font-size='50' fill='white' dy='.3em'>è©•</text></svg>">
    
    <!-- DNS Prefetch for Firebase -->
    <link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="dns-prefetch" href="https://firestore.googleapis.com">
    <link rel="dns-prefetch" href="https://identitytoolkit.googleapis.com">
    
    <!-- Resource hints removed to prevent console warnings -->
</head>
<body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="spinner-border text-white" style="width: 4rem; height: 4rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h2 class="mt-4 text-white">
                <i class="fas fa-hard-hat me-2"></i>
                å»ºè¨­æ¥­è©•ä¾¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
            </h2>
            <p class="text-white-50 mt-2">ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...</p>
            <div class="progress mt-3" style="width: 200px; height: 4px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
            </div>
        </div>
    </div>

<!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
<div id="app" class="d-none">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header id="header-container">
        <!-- ğŸ†• è¨€èªåˆ‡ã‚Šæ›¿ãˆUIã‚’è¿½åŠ  -->
        <div class="language-switcher position-absolute top-0 end-0 p-3" style="z-index: 1000;">
            <select class="form-select form-select-sm" data-i18n-lang-switcher style="width: auto;">
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="en">English</option>
                <option value="vi">Tiáº¿ng Viá»‡t</option>
            </select>
        </div>
    </header>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="d-flex">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <nav id="sidebar-container"></nav>
        
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ç”¨ãƒãƒƒã‚¯ãƒ‰ãƒ­ãƒƒãƒ— -->
        <div id="sidebar-backdrop" class="sidebar-backdrop"></div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main id="content" class="content flex-grow-1" role="main"></main>
    </div>
</div>

    <!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3" aria-live="polite" aria-atomic="true"></div>

    <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="modal-container"></div>
    
    <!-- å¤–éƒ¨JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    
    <!-- Firebaseè¨­å®šã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ– -->
    <script type="module">
        const timestamp = Date.now();
        import(`./app.js?v=${timestamp}`).then(module => {
            const App = module.default;
            window.app = new App();
            return window.app.init();
        }).then(() => {
            console.log('Application initialized successfully');
        }).catch(error => {
            console.error('Failed to initialize application:', error);
            document.getElementById('loading-screen').innerHTML = `
                <div class="loading-content text-center">
                    <div class="text-danger mb-3">
                        <i class="fas fa-exclamation-circle fa-4x"></i>
                    </div>
                    <h2 class="text-white">åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h2>
                    <p class="text-white-50">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
                    <button class="btn btn-light mt-3" onclick="location.reload()">
                        <i class="fas fa-redo me-2"></i>å†è©¦è¡Œ
                    </button>
                </div>
            `;
        });
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen && !loadingScreen.classList.contains('d-none')) {
                loadingScreen.innerHTML = `
                    <div class="loading-content text-center">
                        <div class="text-warning mb-3">
                            <i class="fas fa-exclamation-triangle fa-4x"></i>
                        </div>
                        <h2 class="text-white">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
                        <p class="text-white-50">ã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•ä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>
                        <div class="mt-4">
                            <button class="btn btn-light me-2" onclick="location.reload()">
                                <i class="fas fa-redo me-2"></i>å†èª­ã¿è¾¼ã¿
                            </button>
                            <button class="btn btn-outline-light" onclick="this.nextElementSibling.classList.toggle('d-none')">
                                <i class="fas fa-info-circle me-2"></i>è©³ç´°
                            </button>
                            <div class="d-none mt-3 text-start bg-dark p-3 rounded">
                                <small class="text-white-50">
                                    <code>${event.error?.stack || event.error?.message || 'Unknown error'}</code>
                                </small>
                            </div>
                        </div>
                    </div>
                `;
            }
        });
        
        // æœªå‡¦ç†ã®Promiseæ‹’å¦ã‚’æ•æ‰
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
        });
        
        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ¤œçŸ¥
        window.addEventListener('online', () => {
            console.log('Network connection restored');
            if (window.app) {
                window.app.showSuccess('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãŒå¾©æ—§ã—ã¾ã—ãŸ');
            }
        });
        
        window.addEventListener('offline', () => {
            console.log('Network connection lost');
            if (window.app) {
                window.app.showWarning('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãŒå¤±ã‚ã‚Œã¾ã—ãŸã€‚ä¸€éƒ¨ã®æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
            }
        });
        
        // Phase 8 and Phase 9 integration temporarily disabled for stability
        console.log('Phase 8 and 9 integrations disabled for system stability');

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã¯ä¸Šè¨˜ã®å‹•çš„importã§å®Ÿè¡Œã•ã‚Œã¾ã™
        
        // åˆæœŸåŒ–ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ30ç§’ï¼‰
        const initTimeout = setTimeout(() => {
            console.error('Application initialization timeout');
            document.getElementById('loading-screen').innerHTML = `
                <div class="loading-content text-center">
                    <div class="text-warning mb-3">
                        <i class="fas fa-clock fa-4x"></i>
                    </div>
                    <h2 class="text-white">æ¥ç¶šãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ</h2>
                    <p class="text-white-50">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                    <button class="btn btn-light mt-3" onclick="location.reload()">
                        <i class="fas fa-redo me-2"></i>å†è©¦è¡Œ
                    </button>
                </div>
            `;
        }, 30000);
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã¯å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆå†…ã§å®Ÿè¡Œæ¸ˆã¿
        
        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ç¢ºèªï¼ˆæœªä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆï¼‰
        window.addEventListener('beforeunload', (event) => {
            if (window.app && window.app.hasUnsavedChanges && window.app.hasUnsavedChanges()) {
                event.preventDefault();
                event.returnValue = 'ä¿å­˜ã•ã‚Œã¦ã„ãªã„å¤‰æ›´ãŒã‚ã‚Šã¾ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã¾ã™ã‹ï¼Ÿ';
            }
        });
        
        // ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯å¯¾å¿œ
        window.addEventListener('popstate', () => {
            if (window.app && window.app.router) {
                window.app.router.route();
            }
        });
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.DEBUG = true;
            console.log('Debug mode enabled');
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
            window.debugApp = {
                clearCache: () => {
                    if (window.app && window.app.api && window.app.api.cache) {
                        window.app.api.cache.clear();
                        console.log('Cache cleared');
                    }
                },
                showUser: () => {
                    console.log('Current user:', window.app?.currentUser);
                },
                toggleHighContrast: () => {
                    if (window.app && window.app.accessibility) {
                        window.app.accessibility.toggleHighContrast();
                    }
                },
                reloadApp: () => {
                    location.reload();
                }
            };
        }
        
        // Service Worker ç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
        if (window.performance && window.performance.mark) {
            window.performance.mark('app-init-start');
            window.addEventListener('load', () => {
                window.performance.mark('app-init-end');
                window.performance.measure('app-init', 'app-init-start', 'app-init-end');
                const measure = window.performance.getEntriesByName('app-init')[0];
                console.log(`App initialization took ${measure.duration.toFixed(2)}ms`);
            });
        }
    </script>

    <!-- ãƒãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¯¾å¿œ -->
    <noscript>
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999;">
            <div style="text-align: center; color: white; padding: 20px;">
                <i class="fas fa-exclamation-triangle fa-4x mb-3"></i>
                <h2>JavaScriptãŒç„¡åŠ¹ã§ã™</h2>
                <p>ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯JavaScriptã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚</p>
                <a href="https://enable-javascript.com/ja/" target="_blank" style="color: white; text-decoration: underline;">
                    JavaScriptã‚’æœ‰åŠ¹ã«ã™ã‚‹æ–¹æ³•
                </a>
            </div>
        </div>
    </noscript>
</body>
</html>
